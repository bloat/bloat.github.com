<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Some Clojure Projects</title>
<!-- 2015-02-26 Thu 21:52 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Andrew Cowper" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="stylesheet.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Some Clojure Projects</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#small-pieces-3"><span class="timestamp-wrapper"><span class="timestamp">&lt;2015-02-18&gt;</span></span> Lisp In Small Pieces (In Clojure)</a></li>
<li><a href="#maze-logic-2"><span class="timestamp-wrapper"><span class="timestamp">&lt;2013-01-09&gt;</span></span> Maze Logic - Part II</a></li>
<li><a href="#maze-logic"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-12-19&gt;</span></span> Maze Logic</a></li>
<li><a href="#thorny"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-12-04&gt;</span></span> A Thorny Issue</a></li>
<li><a href="#yahtzee"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-10-23&gt;</span></span> Yahtzee in Clojure</a></li>
<li><a href="#org-babel-ps"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-09-05&gt;</span></span> Org Babel Clojurescript Talk - Postscript</a></li>
<li><a href="#org-babel-talk"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-09-04&gt;</span></span> Org Babel Talk</a></li>
<li><a href="#maze-game-dojo"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-07-31&gt;</span></span> Maze Game Dojo</a></li>
<li><a href="#clojurescript-automata"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-06-30&gt;</span></span> ClojureScript Automata</a></li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="intro">Intro</h2>
<div class="outline-text-2" id="text-1">
<p>
In which I document various projects and diversions executed using
<a href="http://clojure.org">Clojure</a>.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="small-pieces-3"><span class="timestamp-wrapper"><span class="timestamp">&lt;2015-02-18&gt;</span></span> Lisp In Small Pieces (In Clojure)</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="https://gist.github.com/bloat/7ea25a931e3b2b930100#file-l-i-s-p-chapter-3">This gist</a> is chapter 3 of <a href="http://www.amazon.com/Lisp-Small-Pieces-Christian-Queinnec/dp/0521545668">Lisp In Small Pieces</a> - ported to Clojure. It was
a fairly natural port, since the object system used in chapter 3 (not
implemented until chapter 11) is easily simulated using Clojure's
multimethods, and keyword heirarchies. 
</p>

<p>
Here are some fun forms you can try to evaluate. Bonus points for
being able to mentally follow what is going on with all the
continuations flying around!
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #586e75; font-style: italic;">;; </span><span style="color: #586e75; font-style: italic;">returns 3, since the throw to the first catch is interrupted </span>
<span style="color: #586e75; font-style: italic;">;; </span><span style="color: #586e75; font-style: italic;">by another throw.</span>
(<span style="color: #859900;">catch</span> 1
       (<span style="color: #859900;">catch</span> 2 (* 7
                   (<span style="color: #859900;">throw</span> 1 (<span style="color: #859900;">throw</span> 2 3)))))

<span style="color: #586e75; font-style: italic;">;; </span><span style="color: #586e75; font-style: italic;">proves that the cleanup form in the unwind protect </span>
<span style="color: #586e75; font-style: italic;">;; </span><span style="color: #586e75; font-style: italic;">is being run during a throw.</span>
((<span style="color: #859900;">lambda</span> (a) (cons (<span style="color: #859900;">catch</span> 1
                          (<span style="color: #859900;">unwind-protect</span>
                           (<span style="color: #859900;">throw</span> 1 89)
                           (<span style="color: #859900;">set!</span> a 45)))
                   a))
 34)

<span style="color: #586e75; font-style: italic;">;; </span><span style="color: #586e75; font-style: italic;">proves that the return-from works, and that the cleanup form </span>
<span style="color: #586e75; font-style: italic;">;; </span><span style="color: #586e75; font-style: italic;">in the unwind-protect is being run.</span>
((<span style="color: #859900;">lambda</span> (a) (cons (<span style="color: #859900;">block</span> 1 (<span style="color: #859900;">unwind-protect</span>
                             (<span style="color: #859900;">return-from</span> 1 2)
                             (<span style="color: #859900;">set!</span> a 89))
                          3)
                   a))
 34)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="maze-logic-2"><span class="timestamp-wrapper"><span class="timestamp">&lt;2013-01-09&gt;</span></span> Maze Logic - Part II</h2>
<div class="outline-text-2" id="text-3">
<p>
Here's another version of a maze solver in core logic. It uses the
same algorithm as my <a href="#maze-logic">second previous attempt</a>, but I'm now using defne
and matche to deconstruct the incoming logic variables, rather than
all the work I was doing previously with firsto and resto. It doesn't
seem to be any faster, but the code is certainly cleaner.
</p>

<p>
As before there are more details in the project's <a href="https://github.com/bloat/maze.logic/blob/master/README.org">README</a>, and the
<a href="https://github.com/bloat/maze.logic">source code</a>, both at github.
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="maze-logic"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-12-19&gt;</span></span> Maze Logic</h2>
<div class="outline-text-2" id="text-4">
<p>
There were two good talks at <a href="http://skillsmatter.com/event/scala/clojure-exchange-2012">Clojure eXchange</a> about Clojure's logic
programming library core.logic. I decided to have a go myself and see
if I could use core.logic to solve mazes. I have already written some
<a href="#maze-game-dojo">code to generate mazes</a> so the challenge is simply to see if
core.logic can print out a path between the start and end points of
the maze.
</p>

<p>
The answer is that of course it can, but I need to learn to write
efficient logic code as my first two attempts can not solve mazes of
any significant size.
</p>

<p>
There are more details in the project's <a href="https://github.com/bloat/maze.logic/blob/master/README.org">README</a>, and of course the
<a href="https://github.com/bloat/maze.logic">source code</a>, all at github.
</p>

<p>
There will be more attempts posted here, and hopefully I can address
my performance issues.
</p>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="thorny"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-12-04&gt;</span></span> A Thorny Issue</h2>
<div class="outline-text-2" id="text-5">
<p>
I gave a <a href="http://skillsmatter.com/event/home/london-clojurians-user-group-1487">short talk today</a> about an issue I was having with Clojure
and Java interop.
</p>

<p>
The issue in question was how to determine which particular overloaded
Java method is called when a single Clojure entity satisfies the
requirements of both methods. The example I used is the submit method
on the Java <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ExecutorService.html">ExecutorService</a>. There are three versions of the submit
method, and two of them take one argument. One version takes a
<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html">Runnable</a>, and the other takes a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Callable.html">Callable</a>. A Clojure function
implements both of these interfaces, so when you try and submit a
function for an ExecutorService to run, how does Clojure choose which
submit method to call?
</p>

<p>
It turns out that it will call the version that takes a Runnable,
unless you take steps to force it to use the Callable version. The
various permutations of using type hints, casts, and reify to cause
this to happen are detailed in the talk, but the best solution, as
suggested by <a href="http://twitter.com/philandstuff">@philandstuff</a> during the talk is to type hint the
function as a Callable, and the ExecutorService as an ExecutorService.
</p>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #859900;">defn</span> <span style="color: #b58900;">submit-callable-hints</span> [^<span style="color: #268bd2;">Callable</span> c ^<span style="color: #268bd2;">ExecutorService</span> ex]
  (<span style="color: #d33682;">.submit</span> ex c))
</pre>
</div>

<p>
Thanks to everyone who came to see the talk. There are a couple of
artifacts from the presentation.
</p>

<ul class="org-ul">
<li>The <a href="https://gist.github.com/4208492">file</a> I wrote during the presentation.
</li>
<li><a href="http://skillsmatter.com/podcast/home/a-thorny-issue-in-java-interop">The video</a> (posted by the people at <a href="http://skillsmatter.com">Skillsmatter</a>.)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="yahtzee"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-10-23&gt;</span></span> Yahtzee in Clojure</h2>
<div class="outline-text-2" id="text-6">
<p>
I've written a small implementation of the game of <a href="http://en.wikipedia.org/wiki/Yahtzee">Yahtzee</a> in Clojure.
</p>

<p>
The <a href="http://github.com/bloat/yahtzee">code is on github</a>.
</p>

<p>
The aim was to be as purely functional as possible, and I think I
achieved this. The only parts of the code that are not purely
functional are the dice rolling function, for obvious reasons, and the
UI, which is made a bit more convenient to use by keeping the game
state for you.
</p>

<p>
There is also a good separation of the game code from the UI, so I
could go on to implement other UIs, or plug the game into a game
server without any changes. I would like to see how easy it is to
convert my <a href="https://github.com/bloat/maze-game">maze game dojo</a> code so that participants can play Yahtzee
instead of solving mazes. The maze game allows players to upload
Clojure code to solve mazes - it would be good to try and extract a
generic AI competition server, so that implementers can plugin any
game of their choice. I'm sure there are lots of games for which it
would be fun to write a robot player in a dojo environment.
</p>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="org-babel-ps"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-09-05&gt;</span></span> Org Babel Clojurescript Talk - Postscript</h2>
<div class="outline-text-2" id="text-7">
<p>
Thanks to everyone who came along to the <a href="http://skillsmatter.com/event/home/london-clojurians-user-group-1487">London Clojurians meetup</a>
yesterday. I really enjoyed giving my talk and seeing the other
presenters (<a href="http://twitter.com/sw1nn">@sw1nn</a> and <a href="http://twitter.com/philandstuff">@philandstuff</a>) do their respective thing.
</p>

<p>
The talk was mostly about the Org mode emacs extension and how it can
be used for literate programming. I demoed some nice Org features for
working with source code, using a mixture of Clojurescript and Elisp.
</p>

<p>
I've posted some artifacts from my presentation.
</p>

<ul class="org-ul">
<li>The <a href="https://raw.github.com/bloat/Org-Babel-Presentation/master/presentation.org">file</a> I wrote during the presentation, and the <a href="http://git.slothrop.net/Org-Babel-Presentation/presentation.html">exported version</a>.
</li>
<li>The <a href="http://git.slothrop.net/Org-Babel-Presentation/links.html">links and bibliography</a> file I didn't have time to go through.
</li>
<li><a href="http://skillsmatter.com/podcast/home/lightening-talk-literate-programming-with-clojure-and-org-babel">The video</a> (posted by the people at <a href="http://skillsmatter.com">Skillsmatter</a>.)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="org-babel-talk"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-09-04&gt;</span></span> Org Babel Talk</h2>
<div class="outline-text-2" id="text-8">
<p>
I am giving a short <a href="http://skillsmatter.com/event/clojure/london-clojurians-user-group-1487">talk at Skills Matter</a> in London about Org, Babel and
Clojure on the 4th of September 2012.
</p>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="maze-game-dojo"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-07-31&gt;</span></span> Maze Game Dojo</h2>
<div class="outline-text-2" id="text-9">
<p>
The <a href="http://londonclojurians.org">London Clojurians</a> group organise a regular Dojo where people get
together one or two evenings a month and practice some Clojure coding.
</p>

<p>
Its always a fun event and recently one of the participants wrote a
server which would allow people to upload code that could play
battleships. Inspired by this I wrote a similar server which would let
people write code to solve simple mazes.
</p>

<p>
There are a few parts to the game. There is code to generate new mazes
randomly. The maze is contained in a square grid, and the algorithm to
create a new maze picks a random cell in the grid and grows a new maze
from that point, putting in new passage ways and junctions at
random. It is called a growing tree alogrithm, and as the name
suggests it essentially generates a tree within the grid, and there
are no loops in the generated mazes.
</p>

<p>
Players must write a function to solve the mazes. The function takes
arguments describing the view of the maze from its current position,
and it must return the move it wants to make. Given two functions, the
code pits them against each other as they try and solve the same
maze. The winner is the function that gets to the end in the fewest
number of moves.
</p>

<p>
The controller portion of the code is responsible for picking the
functions that will play against each other in each round and keeping
score.
</p>

<p>
Finally there is a module for the UI, which is a website that displays
the current scores and allows players to upload new maze solving
functions.
</p>

<p>
<a href="https://github.com/bloat/maze-game">The code is available</a>, and the README contains a full description of
how to write a function to play the game, and how to run the server.
</p>

<p>
The dojo is a constrained environment in that it is short, only 90
minutes or so of coding time, and people come with many different
levels of Clojure experience. Any activity has to be tractable within
that time - people love to make progress and have something for the
show and tell session at then end. I think that (more by luck than
judgement) I came up with a problem that fitted pretty well. Every
group managed to produce a function that could solve a maze, and the
scoreboard showed a pretty wide spread of success when the functions
were raced against each other. The other good thing about this problem
is that it is easy to think up a very simple strategy that has a good
chance of solving mazes, i.e. pick a random move each turn. Lots of
people started with this technique and it proved to be a good base to
build from.
</p>

<p>
One thing I did consciously do was to make sure the documentation was
good enough that people could get the code running quickly - it is a
real pain in a short dojo to be spending lots of time before you can
even start thinking about the problem. To this end the README contains
simple instructions for running the code, generating mazes, and
testing solver functions.
</p>

<p>
<a href="http://git.slothrop.net/maze-game/index.html">The results</a> of the evening's coding are archived for posterity. Thanks
to everyone who took part!
</p>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="clojurescript-automata"><span class="timestamp-wrapper"><span class="timestamp">&lt;2012-06-30&gt;</span></span> ClojureScript Automata</h2>
<div class="outline-text-2" id="text-10">
<p>
I last wrote a web application a long time ago, so I decided it was
time to dip my toes in the waters again and learn a little bit about
the modern way to do things. 
</p>

<p>
In the olden days we wrote JSPs for the front end, and EJBs for the
backend. For this experiment I didn't worry about any backend and
decided to write a front end application purely in ClojureScript. So I
learnt a bit about ClojureScript, CSS and a modern JavaScript API - in
this case Google Closure.
</p>

<p>
I also wanted to try my hand at Literate Programming, the technique
where a program is made more readable by mixing explanation and
exposition in with the source code. You can then generate a pure
source code file, or a nicely formatted document from the same source
file. For this I used <a href="http://orgmode.org">Org</a> and its <a href="http://orgmode.org/worg/org-contrib/babel/">Babel</a> extension.
</p>

<p>
The program I wrote draws diagrams of one-dimensional cellular
automata.
</p>

<p>
I exported the main source file to HTML and <a href="http://git.slothrop.net/automata">posted it here</a>.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="contact"><a href="mailto:andrew.cowper@slothrop.net">andrew.cowper@slothrop.net</a> | @magic_bloat | Created with <a href="http://orgmode.org">Org</a> | </p><p class="license"><a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /><br /></a>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.</p>
</div>
</body>
</html>
